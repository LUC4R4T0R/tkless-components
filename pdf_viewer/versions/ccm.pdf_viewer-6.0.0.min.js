(()=>{const component={name:"pdf_viewer",version:[6,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.4.0.js",config:{html:{main:{id:"pdf-view",inner:[{id:"canvas",tag:"canvas"},{id:"nav",inner:[{title:"Previous Slide",class:"prev disabled fa fa-chevron-left fa-lg",onclick:"%prev%"},{title:"First Slide",class:"first disabled fa fa-step-backward fa-lg",onclick:"%first%"},{tag:"input",type:"number",id:"page-num",onchange:"%go_to%"},{title:"Last Slide",class:"last fa fa-step-forward fa-lg",onclick:"%last%"},{title:"Next Slide",class:"next fa fa-chevron-right fa-lg",onclick:"%next%"}]},{id:"optional_content"}]}},pdfJS:["ccm.load","https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.3.200/pdf.js"],pdfJS_workerSrc:["ccm.load","https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.3.200/pdf.worker.js"],routing:["ccm.instance","https://ccmjs.github.io/akless-components/routing/versions/ccm.routing-2.0.4.js",{app:"pdf_viewer"}],css:["ccm.load",{context:"head",url:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"},"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css","https://ccmjs.github.io/tkless-components/pdf_viewer/resources/player.css"],helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-5.0.0.mjs"]},Instance:function(){const self=this;let $;let pdfDoc,pageNum,pageRendering,pageNumPending,ctx;let file,canvas,page_elem;this.init=async()=>{file=self.pdf;pdfDoc=null;pageNum=1;pageRendering=false;pageNumPending=null};this.ready=async()=>{$=Object.assign({},this.ccm.helper,this.helper);if(self.logger)self.logger.log("ready",$.clone(self));let pdfjsLib=window["pdfjs-dist/build/pdf"];if(!pdfjsLib.GlobalWorkerOptions.workerSrc)pdfjsLib.GlobalWorkerOptions.workerSrc=self.pdfJS_workerSrc;if($.isObject(self.pdf)&&self.pdf.slides)self.pdf=self.pdf.slides[0].data;if(self.pdf)pdfDoc=await pdfjsLib.getDocument(self.pdf).promise};this.start=async()=>{if(self.logger)self.logger.log("start");if(!self.pdf)return $.setContent(self.element,"No File to Display");$.setContent(self.element,$.html(self.html.main,{prev:()=>{onPrevPage()},next:()=>{onNextPage()},go_to:()=>{goTo(self.element.querySelector("#page-num").value);self.element.querySelector("#page-num").value=""},all:()=>{pdfDoc.numPages},last:()=>{goTo(pdfDoc.numPages)},first:()=>{goTo("1")}}));canvas=self.element.querySelector("canvas");canvas.addEventListener("contextmenu",(event=>{event.preventDefault()}));ctx=canvas.getContext("2d");page_elem=self.element.querySelector("#pdf-view");if(self.routing&&self.routing.get()){pageNum=self.routing.get().split("-")[1];self.onchange&&self.onchange(self,pageNum)}else renderPage(pageNum);touchEventHandling();self.routing&&self.routing.define({page:number=>renderPage(number)})};function renderPage(num){num=parseInt(num);pageRendering=true;pdfDoc.getPage(num).then((function(page){let viewport=page.getViewport({scale:1});let scale=page_elem.clientWidth/viewport.width;viewport=page.getViewport({scale:scale});canvas.height=viewport.height;canvas.width=viewport.width;let renderContext={canvasContext:ctx,viewport:viewport};let renderTask=page.render(renderContext);renderTask.promise.then((function(){pageRendering=false;if(pageNumPending!==null){renderPage(pageNumPending);pageNumPending=null}if(pdfDoc.numPages>1){self.element.querySelector("#nav").style.width=self.element.querySelector("#canvas").offsetWidth+"px";self.element.querySelector("#page-num").placeholder=num+" / "+pdfDoc.numPages}else self.element.querySelector("#nav").remove()}))}),(function(err){console.log(err)}));checkButtons()}this.onbreakpoint=()=>{renderPage(pageNum)};function touchEventHandling(){let reachedEdge=false;let touchStart=null;let touchDown=false;page_elem.addEventListener("touchstart",(function(){touchDown=true}));page_elem.addEventListener("touchmove",(function(event){if(page_elem.scrollLeft===0||page_elem.scrollLeft===page_elem.scrollWidth-page_elem.clientWidth){reachedEdge=true}else{reachedEdge=false;touchStart=null}if(reachedEdge&&touchDown){if(touchStart===null){touchStart=event.changedTouches[0].clientX}else{let distance=event.changedTouches[0].clientX-touchStart;if(distance<-100){touchStart=null;reachedEdge=false;touchDown=false;onNextPage()}else if(distance>100){touchStart=null;reachedEdge=false;touchDown=false;onPrevPage()}}}}));page_elem.addEventListener("touchend",(function(){touchStart=null;touchDown=false}))}function queueRenderPage(num){if(pageRendering){pageNumPending=num}else{renderPage(num);self.element.querySelector("#nav").style.width=self.element.querySelector("#canvas").offsetWidth+"px";self.onchange&&self.onchange(self,num);self.routing&&self.routing.set("page-"+num)}}function goTo(page){if(page>pdfDoc.numPages||page<1)return;pageNum=page;queueRenderPage(parseInt(pageNum));if(self.logger)self.logger.log("goto",parseInt(page))}function onPrevPage(){if(pageNum<=1){return}pageNum--;queueRenderPage(pageNum);if(self.logger)self.logger.log("prev",pageNum)}function onNextPage(){if(pageNum>=pdfDoc.numPages){return}pageNum++;queueRenderPage(pageNum);if(self.logger)self.logger.log("next",pageNum)}function checkButtons(){if(pageNum==1){self.element.querySelector(".prev").classList.add("disabled");self.element.querySelector(".first").classList.add("disabled");self.element.querySelector(".next").classList.remove("disabled");self.element.querySelector(".last").classList.remove("disabled")}else if(pageNum==pdfDoc.numPages){self.element.querySelector(".next").classList.add("disabled");self.element.querySelector(".last").classList.add("disabled");self.element.querySelector(".prev").classList.remove("disabled");self.element.querySelector(".first").classList.remove("disabled")}else{self.element.querySelector(".next").classList.remove("disabled");self.element.querySelector(".last").classList.remove("disabled");self.element.querySelector(".prev").classList.remove("disabled");self.element.querySelector(".first").classList.remove("disabled")}}}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();
//# sourceMappingURL=ccm.pdf_viewer-6.0.0.min.js.map