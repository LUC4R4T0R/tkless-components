(function(){const component={name:"voting",version:[4,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.4.0.js",config:{html:{main:{id:"main",inner:[{id:"top"},{tag:"div",id:"likes",class:"%likes%",onclick:"%up_vote%"},{tag:"div",id:"total"},{tag:"div",id:"dislikes",class:"%dislikes%",onclick:"%down_vote%"}]}},icon_dislikes:"fa fa-lg fa-chevron-circle-down",icon_likes:"fa fa-lg fa-chevron-circle-up",libs:["ccm.load",{context:"head",url:"https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"},"https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css","https://ccmjs.github.io/tkless-components/voting/resources/default.css"],helper:["ccm.load",{url:"https://ccmjs.github.io/akless-components/modules/versions/helper-5.0.0.mjs"}]},Instance:function(){let $,total=0,dataset,main_elem;this.init=(async()=>{if(this.user)this.user.onchange=this.start;this.data.store.onchange=this.start});this.ready=(async()=>{$=this.ccm.helper;$=Object.assign({},this.ccm.helper,this.helper);if(this.logger)this.logger.log("ready",$.clone(this))});this.start=(async()=>{await renderContent();$.setContent(this.element,main_elem)});const renderContent=async()=>{dataset=await $.dataset(this.data);if(!dataset.likes)dataset.likes={};if(!dataset.dislikes)dataset.dislikes={};main_elem=$.html(this.html.main,{likes:this.icon_likes,up_vote:async event=>{event.preventDefault();await doVoting("likes")},dislikes:this.icon_dislikes,down_vote:async event=>{event.preventDefault();await doVoting("dislikes")}});if(this.user){$.append(main_elem.querySelector("#top"),this.user.root);this.user.start()}setIconAvailability();$.setContent(main_elem.querySelector("#total"),this.getValue())};const setIconAvailability=()=>{if(!this.user||!this.user.isLoggedIn())return;let user=this.user.getValue().key;if(dataset.likes[user])main_elem.querySelector("#likes").classList.add("disabled");if(dataset.dislikes[user])main_elem.querySelector("#dislikes").classList.add("disabled")};const doVoting=async vote=>{if(!this.user)return;await this.user.login(true);let user=this.user.getValue().key;let not_vote;if(this.onvote&&!this.onvote({user:user}))return;if(vote==="likes")not_vote="dislikes";else not_vote="likes";if(dataset[vote][user]){delete dataset[vote][user]}else{dataset[vote][user]=true;delete dataset[not_vote][user]}dataset.total=this.getValue();await this.data.store.set(dataset);await this.start()};this.getValue=(()=>{return total=Object.keys(dataset.likes).length-Object.keys(dataset.dislikes).length})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();