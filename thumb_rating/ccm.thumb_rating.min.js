(function(){const component={name:"thumb_rating",ccm:"https://ccmjs.github.io/ccm/ccm.js",config:{html:{main:{inner:[{id:"login-section"},{id:"rating-section"}]},simple:{inner:[{id:"likes",class:"fa fa-thumbs-up",inner:"&#8198;%likes%"},{id:"dislikes",class:"fa fa-thumbs-down",inner:"&#8198;%dislikes%"}]},buttons:{inner:[{id:"likes",tag:"button",class:"btn btn-outline-secondary",type:"btn",inner:[{tag:"i",class:"fa fa-thumbs-up icon"},{tag:"span",inner:"&nbsp;%likes%"}]},{id:"dislikes",tag:"button",class:"btn btn-outline-secondary",type:"btn",inner:[{tag:"i",class:"fa fa-thumbs-down icon"},{tag:"span",inner:"&nbsp;%dislikes%"}]}]}},libs:["ccm.load","https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css",{context:"head",url:"https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"},"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css","../thumb_rating/resources/default.css"],helper:["ccm.load",{url:"https://ccmjs.github.io/akless-components/modules/versions/helper-5.0.0.mjs"}]},Instance:function(){let $,dataset,main_elem;let total=0;this.init=(async()=>{if(this.user)this.user.onchange=this.start;this.data.store.onchange=this.start});this.ready=(async()=>{$=this.ccm.helper;$=Object.assign({},this.ccm.helper,this.helper);if(this.logger)this.logger.log("ready",$.clone(this))});this.start=(async()=>{dataset=await $.dataset(this.data);if(!dataset.likes)dataset.likes={};if(!dataset.dislikes)dataset.dislikes={};main_elem=$.html(this.html.main);main_elem.querySelector("#rating-section").classList.add("user");if(this.logger)this.logger.log("start",$.clone(dataset));if(this.user){$.append(main_elem.querySelector("#login-section"),this.user.root);this.user.start()}await renderThumbs();$.setContent(this.element,main_elem)});const renderThumbs=async()=>{const template=this.template==="buttons"?this.html.buttons:this.html.simple;const rating_elem=$.html(template,{likes:Object.keys(dataset.likes).length,dislikes:Object.keys(dataset.dislikes).length});await setIconAvailability(rating_elem);$.setContent(main_elem.querySelector("#rating-section"),rating_elem)};const setIconAvailability=async elem=>{const div={likes:elem.querySelector("#likes"),dislikes:elem.querySelector("#dislikes")};if(this.user&&this.user.isLoggedIn()){let user=this.user.getValue().key;if(dataset.likes[user])div["likes"].classList.add("selected");if(dataset.dislikes[user])div["dislikes"].classList.add("selected")}else{if(this.template==="buttons"){div["likes"].classList.add("disabled");div["dislikes"].classList.add("disabled")}}if(this.user){await doVoting("likes","dislikes",div);await doVoting("dislikes","likes",div)}};const doVoting=async(index,other,div)=>{div[index].addEventListener("click",async()=>{await this.user.login(true);const user=this.user.getValue().key;if(this.onvote&&!this.onvote({user:user}))return;if(dataset[index][user]){delete dataset[index][user]}else{dataset[index][user]=true;delete dataset[other][user]}dataset.total=this.getValue();await this.data.store.set(dataset);this.logger&&this.logger.log("click",index);await this.start()})};this.getValue=(()=>{return total=Object.keys(dataset.likes).length-Object.keys(dataset.dislikes).length})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();