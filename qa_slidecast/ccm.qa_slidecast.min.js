(()=>{const component={name:"qa_slidecast",ccm:"https://ccmjs.github.io/ccm/versions/ccm-27.3.1.min.js",config:{css:["ccm.load","https://ccmjs.github.io/tkless-components/qa_slidecast/resources/styles.min.css","https://ccmjs.github.io/tkless-components/libs/bootstrap-5/css/bootstrap-icons.min.css",{url:"https://ccmjs.github.io/tkless-components/libs/bootstrap-5/css/bootstrap-fonts.min.css",context:"head"}],dark:"auto",helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-8.1.0.min.mjs"],html:["ccm.load","https://ccmjs.github.io/tkless-components/qa_slidecast/resources/templates.mjs"],open:"both",pdf_viewer:["ccm.instance","https://ccmjs.github.io/tkless-components/pdf_viewer/versions/ccm.pdf_viewer-7.3.0.min.js"],slide_nr:1,ignore:{},text:["ccm.load","https://ccmjs.github.io/tkless-components/qa_slidecast/resources/resources.mjs#text_en"],youtube:["ccm.component","https://ccmjs.github.io/akless-components/youtube/versions/ccm.youtube-2.1.1.js"]},Instance:function(){let $;this.init=async()=>{$=Object.assign({},this.ccm.helper,this.helper);$.use(this.ccm);if(this.comment&&!this.comment.config.data.key)this.comment.config.data.key=$.generateKey();delete this.pdf_viewer.routing;if(this.lang)this.lang.dark=this.dark;this.pdf_viewer.dark=this.dark};this.ready=async()=>{this.pdf_viewer.onchange=async event=>{if(this.onchange&&await this.onchange({name:event.name,instance:this,before:true}))return;if(event.before){let slide;switch(event.name){case"first":slide=1;break;case"prev":slide=this.slide_nr-1;break;case"jump":slide=event.page;break;case"next":slide=this.slide_nr+1;break;case"last":slide=this.ignore.slides.length;break}if(!(slide>=1&&slide<=this.ignore.slides.length&&slide!==this.slide_nr))return;this.slide_nr=slide;this.routing&&this.routing.set("slide-"+slide);await render()}if(this.onchange&&await this.onchange({name:event.name,instance:this}))return;return true};this.routing&&this.routing.define({slide:number=>{this.slide_nr=number;render()}});this.logger&&this.logger.log("ready",$.privatize(this,true));this.dark==="auto"&&this.element.classList.add("dark_auto");this.dark===true&&this.element.classList.add("dark_mode")};this.start=async()=>{this.logger&&this.logger.log("start",this.getValue());await this.pdf_viewer.start();if(!this.ignore.slides){this.ignore.slides=[];for(let page=1;page<=this.pdf_viewer.getPages();page++)this.ignore.slides.push({content:page})}if(this.routing&&this.routing.get())await this.routing.refresh();else await render();const header=this.element.querySelector("header");if(header){header&&this.lang&&!this.lang.getContext()&&$.append(header,this.lang.root);header&&this.user&&$.append(header,this.user.root)}this.onstart&&await this.onstart(this)};this.getValue=()=>{return{slide_nr:this.slide_nr,slides:$.clone(this.ignore.slides)}};const render=async skip=>{const slide_data=this.ignore.slides[this.slide_nr-1]||{};this.html.render(this.html.main(this,events),this.element);this.lang&&this.lang.translate();const viewer_element=this.element.querySelector("#viewer");!viewer_element.innerHTML&&$.setContent(viewer_element,this.pdf_viewer.root);if(skip)return;const slide_element=this.pdf_viewer.element.querySelector("#page");const content=await $.appDependency(slide_data.content)||slide_data.content;switch(typeof content){case"number":$.setContent(slide_element,"<canvas>");$.append(slide_element,'<div id="text-layer"></div>');await this.pdf_viewer.goTo(content);delete slide_data._content;break;case"string":const ends_with=content.split(".").pop();switch(ends_with){case"apng":case"gif":case"jpg":case"jpeg":case"jfif":case"pjpeg":case"pjp":case"png":case"svg":if(!slide_data._content)slide_data._content=$.html(this.html.image,content);break;case"mp4":case"ogg":case"webm":if(!slide_data._content)slide_data._content=$.html(this.html.video,content);break;default:if(content.includes("youtu")){if(!slide_data._content){const video=content.split("/").pop().split("?v=").pop().split("&").shift();const app=await this.youtube.start({video:video,dark:this.dark});slide_data._content=app.root}}else{$.setContent(slide_element,content);delete slide_data._content}}break;default:if($.isDependency(content)){if(!slide_data._content)slide_data._content=(await $.solveDependency(content)).root}else{$.setContent(slide_element,content);delete slide_data._content}}slide_data._content&&$.setContent(slide_element,slide_data._content);const update=(selector,condition)=>this.pdf_viewer.element.querySelector(selector)[(condition?"set":"remove")+"Attribute"]("disabled",true);update("#first > *",this.slide_nr<=1);update("#prev > *",this.slide_nr<=1);this.pdf_viewer.element.querySelector("#jump input").setAttribute("placeholder",this.slide_nr+" / "+this.ignore.slides.length);update("#next > *",this.slide_nr>=this.ignore.slides.length);update("#last > *",this.slide_nr>=this.ignore.slides.length);const description_element=this.element.querySelector("#description");if(slide_data.description&&!slide_data._description){const description=await $.appDependency(slide_data.description)||slide_data.description;if($.isDependency(description)){slide_data._description=(await $.solveDependency(description)).root}else if(typeof slide_data.description!=="string"){$.setContent(slide_element,slide_data.description);delete slide_data._description}else $.setContent(description_element,$.html("<article>%%</article>",slide_data.description))}slide_data._description&&$.setContent(description_element,slide_data._description);if(this.comment&&slide_data.commentary!==false){if(!slide_data.comments)slide_data.comments=await this.comment.start({dark:this.dark,"data.key":this.comment.config.data.key+"-"+slide_data.key});$.setContent(this.element.querySelector("#comments"),slide_data.comments.root)}};const events={onDescription:()=>{const slide_data=this.ignore.slides[this.slide_nr-1];if(!slide_data.description)return;switch(this.open){case"":this.open="description";break;case"description":this.open="";break;case"comments":this.open="both";break;case"both":this.open="comments";break}render(true)},onComments:()=>{const slide_data=this.ignore.slides[this.slide_nr-1];if(!this.comment||slide_data.commentary===false)return;switch(this.open){case"":this.open="comments";break;case"description":this.open="both";break;case"comments":this.open="";break;case"both":this.open="description";break}render(true)}}}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||[""])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){(c="latest"?window.ccm:window.ccm[c]).component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();